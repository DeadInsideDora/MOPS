{
  "title": "IoT Overview",
  "uid": "iot-overview",
  "schemaVersion": 39,
  "version": 1,
  "refresh": "10s",
  "panels": [
    {
      "type": "stat",
      "title": "Ingest rate (req/s)",
      "targets": [
        {
          "expr": "sum(rate(iot_controller_requests_total[5m]))",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 0 }
    },
    {
      "type": "stat",
      "title": "Ingest errors (5m)",
      "targets": [
        {
          "expr": "sum(rate(iot_controller_requests_failed_total[5m]))",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 0 }
    },
    {
      "type": "stat",
      "title": "Rule hits (5m)",
      "targets": [
        {
          "expr": "sum(rate(rule_engine_hits_total[5m]))",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 0 }
    },
    {
      "type": "graph",
      "title": "Ingest latency p95",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(iot_controller_request_seconds_bucket[5m])))",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 4 }
    },
    {
      "type": "graph",
      "title": "Rule engine latency",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(rule_engine_process_seconds_bucket[5m])))",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 4 }
    },
    {
      "type": "graph",
      "title": "Rule hits by rule_id",
      "targets": [
        {
          "expr": "sum by (rule_id) (rate(rule_engine_hits_total[5m]))",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 12 }
    },
    {
      "type": "graph",
      "title": "Messages processed",
      "targets": [
        {
          "expr": "sum(rate(rule_engine_processed_total[5m]))",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 12 }
    },
    {
      "type": "graph",
      "title": "RabbitMQ messages ready",
      "targets": [
        {
          "expr": "rabbitmq_queue_messages_ready",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 20 }
    },
    {
      "type": "graph",
      "title": "Postgres connections",
      "targets": [
        {
          "expr": "pg_stat_activity_count",
          "refId": "A"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 20 }
    }
  ],
  "time": { "from": "now-1h", "to": "now" }
}
